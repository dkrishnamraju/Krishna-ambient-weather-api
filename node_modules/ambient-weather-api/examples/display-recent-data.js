require('dotenv').config()
const AmbientWeatherApi = require('../lib/index')
const moment = require('moment-timezone');

const axios = require('axios');

const api = new AmbientWeatherApi({
  apiKey: process.env.AMBIENT_WEATHER_API_KEY || 'f9a59daaecb440f99ce3581b380f4a686c347022d011470e91036ab031c95b61',
  applicationKey: process.env.AMBIENT_WEATHER_APPLICATION_KEY || '8f574908756f401da6ab6cf1ce75f309044a5ed74db3483388552f4af58e1514'
})

// Function to fetch weather data
const fetchWeatherData = async () => {
  try {
      //const response = await axios.get(`https://rt.ambientweather.net/v1/devices/30:83:98:A6:AC:3D?apiKey=${AmbientWeatherApi.apikey}&applicationKey=${AmbientWeatherApi.applicationkey}`);
     // const response = await api._apiRequest(api._getUrl('30:83:98:A6:AC:3D'));
      //const response = await api._getUrl('30:83:98:A6:AC:3D');
      //api.userDevices();
     api.deviceData('30:83:98:A6:AC:3D')
     .then((deviceData) => {
      console.log(data);
     });
  } catch (error) {
      console.error(error);
  }
};

//setInterval(fetchWeatherData, 10000);

function convertToIST(date) {
  const format = 'YYYY-MM-DD hh:mm:ss A';
  const utcDate = moment.utc(date);
  const istDate = utcDate.tz('Asia/Kolkata').format(format);
  return istDate;
}

function fahrenheitToCelsius(fahrenheit) {
  var celsius = (fahrenheit - 32) * 5 / 9;
  return celsius.toFixed(1);
}


//fetchWeatherData();


// list the user's devices
//api.userDevices()
//.then((devices) => {

//  devices.forEach((device) => {
    // fetch the most recent data
    api.deviceData('30:83:98:A6:AC:3D', {limit:1})
    .then((deviceData) => {
      //console.log('The 5 most recent temperature reports for ' + device.info.name + ' - ' + device.info.location + ':')
      deviceData.forEach((data) => {
        console.log(convertToIST(data.date) + ' - ' + fahrenheitToCelsius(data.tempf) + '°C')
      })
      console.log('---')
      //console.log(device.macAddress)
      //const myUrl = api._getUrl(device.macAddress);
      //console.log(myUrl)
      //console.log(deviceData)
      console.log('+++')
    })
//  })
//})


/*
// list the user's devices
api.userDevices()
.then((devices) => {

  devices.forEach((device) => {
    // fetch the most recent data
    api.deviceData(device.macAddress, {
      limit: 5
    })
    .then((deviceData) => {
      console.log('The 5 most recent temperature reports for ' + device.info.name + ' - ' + device.info.location + ':')
      deviceData.forEach((data) => {
        console.log(convertToIST(data.date) + ' - ' + fahrenheitToCelsius(data.tempf) + '°C')
      })
      console.log('---')
      console.log(device.macAddress)
      const myUrl = api._getUrl(device.macAddress);
      console.log(myUrl)
      //console.log(deviceData)
      console.log('+++')
    })
  })
})
*/
